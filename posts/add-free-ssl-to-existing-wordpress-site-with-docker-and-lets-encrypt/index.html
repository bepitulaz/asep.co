<!doctype html>
<html lang="en-gb"><head>
    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
	ga('create', 'UA-136771948-2', 'auto');
	
	ga('send', 'pageview');
}
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


    
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    
    <meta name="description" content="Google announced that they use HTTPS as a ranking signal on 2014, and it becomes more standard in their search result.">

    
    <meta property="og:title" content="Add Free SSL to Existing WordPress Site with Docker and Let&#39;s Encrypt" />
<meta property="og:description" content="Google announced that they use HTTPS as a ranking signal on 2014, and it becomes more standard in their search result." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://asepbagja.com/posts/add-free-ssl-to-existing-wordpress-site-with-docker-and-lets-encrypt/" />

<meta property="og:image" content="https://letsencrypt.org/images/le-logo-standard.png" />
<meta property="article:published_time" content="2016-06-24T00:00:00+00:00" />
<meta property="article:modified_time" content="2016-06-24T00:00:00+00:00" /><meta property="og:site_name" content="ASPBGJ" />


    
    <meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://letsencrypt.org/images/le-logo-standard.png"/>

<meta name="twitter:title" content="Add Free SSL to Existing WordPress Site with Docker and Let&#39;s Encrypt"/>
<meta name="twitter:description" content="Google announced that they use HTTPS as a ranking signal on 2014, and it becomes more standard in their search result."/>



    <link href="/css/plugins.css" rel="stylesheet">
    <link href="/css/style.css" rel="stylesheet">
    <link href="/css/responsive.css" rel="stylesheet">

    <title>Add Free SSL to Existing WordPress Site with Docker and Let&#39;s Encrypt - ASPBGJ</title>

    <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/cookieconsent@3/build/cookieconsent.min.js" data-cfasync="false"></script>
    <script>
    window.addEventListener("load", function(){
    window.cookieconsent.initialise({
      "palette": {
        "popup": {
          "background": "#efefef",
          "text": "#404040"
        },
        "button": {
          "background": "#8ec760",
          "text": "#ffffff"
        }
      },
      "position": "bottom"
    })});
    </script>
</head>
<body>
    <div class="body-inner">
<div id="topbar" class="topbar-fullwidth d-none d-xl-block d-lg-block">
  <div class="container">
    <div class="row">
      <div class="col-12 d-none d-sm-block">
        <div class="social-icons social-icons-colored-hover">
          <ul>
            <li class="social-twitter"><a href="https://twitter.com/bepitulaz"><i class="fab fa-twitter"></i></a></li>
            <li class="social-linkedin"><a href="https://www.linkedin.com/in/asepbagja"><i class="fab fa-linkedin"></i></a></li>
            <li class="social-youtube"><a href="https://www.youtube.com/channel/UCjGnuWk0n6BWx7rXshMysbw"><i class="fab fa-youtube"></i></a></li>
          </ul>
        </div>
      </div>
    </div>
  </div>
</div>

<header id="header" data-fullwidth="true">
  <div class="header-inner">
    <div class="container">
      
      <div id="logo">
        <a href="/" class="ASPBGJ logo">
          ASPBGJ
        </a>
      </div>
      

      
      <div class="header-extras">
        <ul>
          <li>
            <div class="p-dropdown">
              <a href="#"><i class="icon-flag11"></i></a>
              <ul class="p-dropdown-content">
                
                <li><a href="https://asepbagja.com/">English</a></li>
                
                <li><a href="https://asepbagja.com/id/">Bahasa Indonesia</a></li>
                
              </ul>
            </div>
          </li>
        </ul>
      </div>
      

      
      <div id="mainMenu-trigger">
        <button class="lines-button x"> <span class="lines"></span> </button>
      </div>
      

      
      <div id="mainMenu">
        <nav>
          <ul><li class="">
              <a href="/">Home</a>
            </li>
            <li class="">
              <a href="/about">About</a>
            </li>
            <li class="">
              <a href="/posts">Posts</a>
            </li>
          </ul>
        </nav>
      </div>
      
    </div>
  </div>
</header>

<section id="page-content" class="sidebar-right">
  <div class="container">
    <div class="row">
      
      <div class="content col-lg-10 offset-lg-1">
        
        <div id="blog" class="single-post">
          
          <div class="post-item">
            <div class="post-item-wrap">
              <div class="post-item-description">
                <h2>Add Free SSL to Existing WordPress Site with Docker and Let&#39;s Encrypt</h2>
                <div class="post-meta">
                    
                    <span class="post-meta-date"><i class="fa fa-calendar-o"></i>Jun, 24 2016</span>
                    <span class="post-meta-category">
                    
                      
                      
                      <i class="fa fa-tag"></i> <a href="https://asepbagja.com/categories/tips-and-tricks/">Tips and Tricks</a>
                      
                    
                    </span>
                    <div class="post-meta-share">
                      


<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: block; clear: both;}
#share-buttons > div {
position: relative;
text-align: left;
height: 36px;
width: 32px;
float: left;
text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.pinterest:hover > svg {fill: #CB2027;}
#share-buttons > div.gplus:hover > svg {fill: #dd4b39;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.instagram:hover > svg {fill: #C73B92;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.pinterest > svg {height: 20px; margin-top: 9px;}
#share-buttons > div.gplus > svg {height: 17px; margin-top: 9px; position: relative; left: 1px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
</style>

<div id="share-buttons">
<div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https:\/\/asepbagja.com\/\/posts\/add-free-ssl-to-existing-wordpress-site-with-docker-and-lets-encrypt\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
<div class="twitter" title="Share this on Twitter" onclick="window.open('http://twitter.com/home?status=https:\/\/asepbagja.com\/\/posts\/add-free-ssl-to-existing-wordpress-site-with-docker-and-lets-encrypt\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1684 408q-67 98-162 167 1 14 1 42 0 130-38 259.5t-115.5 248.5-184.5 210.5-258 146-323 54.5q-271 0-496-145 35 4 78 4 225 0 401-138-105-2-188-64.5t-114-159.5q33 5 61 5 43 0 85-11-112-23-185.5-111.5t-73.5-205.5v-4q68 38 146 41-66-44-105-115t-39-154q0-88 44-163 121 149 294.5 238.5t371.5 99.5q-8-38-8-74 0-134 94.5-228.5t228.5-94.5q140 0 236 102 109-21 205-78-37 115-142 178 93-10 186-50z"/></svg></div>
<div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https:\/\/asepbagja.com\/\/posts\/add-free-ssl-to-existing-wordpress-site-with-docker-and-lets-encrypt\/&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>

<div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=https:\/\/asepbagja.com\/\/posts\/add-free-ssl-to-existing-wordpress-site-with-docker-and-lets-encrypt\/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
</div>

                    </div>
                </div>
              </div>
              <p>Google announced that they use HTTPS as a ranking signal <a href="https://webmasters.googleblog.com/2014/08/https-as-ranking-signal.html">on 2014</a>, and it becomes more standard in their search result. Therefore, I decide to use HTTPS also for this blog; and it looks pretty too for having a green lock icon on the browser. I&rsquo;m a Docker devotee, so I&rsquo;ll show you how to do it by using Docker.</p>

<p><strong>1. Install Docker on the server</strong></p>

<p>I&rsquo;m using Ubuntu 16.04 on my <a href="https://m.do.co/c/603d8d4e7ded">Digital Ocean</a> droplet. So, you can follow Docker official installation guide for Ubuntu on their documentation page <a href="https://docs.docker.com/engine/installation/linux/ubuntulinux/">here</a>.</p>

<p><strong>2. Run Let&rsquo;s Encrypt companion for Nginx proxy container</strong></p>

<p>Before running this container, I will shortly explain what Let&rsquo;s Encrypt is, in case you never heard it. Taken from its website, it is a free, automated, and open certificate authority (CA), run for the public&rsquo;s benefit. Let&rsquo;s Encrypt is a service provided by the <a href="https://letsencrypt.org/isrg/">Internet Security Research Group (ISRG)</a>. Hence, we don&rsquo;t need to buy and manually renew the SSL certificate anymore.</p>

<p>I assume you are at the home folder (/home/user/). You should create a directory for storing the certificates.</p>

<pre><code>/home/user/:$ mkdir certs
</code></pre>

<p>Then, you will run Nginx as the proxy server for our WordPress container. I&rsquo;m using Nginx proxy image which is maintained by <a href="https://github.com/jwilder/nginx-proxy">jwilder</a>.</p>

<pre><code>/home/user/:$ docker run -d -p 80:80 -p 443:443 \
  --name nginx-proxy \
  -v /home/user/certs:/etc/nginx/certs:ro \
  -v /etc/nginx/vhost.d \
  -v /usr/share/nginx/html \
  -v /var/run/docker.sock:/tmp/docker.sock:ro \
  jwilder/nginx-proxy
</code></pre>

<p>If you look the command above, 3 writable volumes are declared:</p>

<ul>
<li><code>/etc/nginx/certs</code> is for creating and renewing Let&rsquo;s Encrypt certificates</li>
<li><code>/etc/nginx/vhost.d</code> is for changing the configuration of vhosts, and it&rsquo;s needed by Let&rsquo;s Encrypt</li>
<li><code>/usr/share/nginx/html</code> is for writing challenge files, so Let&rsquo;s Encrypt can verify your domain.</li>
</ul>

<p>After the Nginx proxy container is running, you will run Let&rsquo;s Encrypt container to create and renew the certificate for each domain that you want to add the SSL certificate. I will use the Let&rsquo;s Encrypt image which is maintained by <a href="https://github.com/JrCs/docker-letsencrypt-nginx-proxy-companion">JrCs</a>.</p>

<pre><code>/home/user/:$ docker run -d \
  -v /home/user/certs:/etc/nginx/certs:rw \
  --volumes-from nginx-proxy \
  -v /var/run/docker.sock:/var/run/docker.sock:ro \
  jrcs/letsencrypt-nginx-proxy-companion
</code></pre>

<p>Ensure those 2 containers are running by using <code>docker ps</code> command. Then you can start any containers to be proxified with https connection by using this command:</p>

<pre><code>/home/user/:$ docker run -e &quot;VIRTUAL_HOST=yourdomain.com&quot; \
  -e &quot;LETSENCRYPT_HOST=yourdomain.com,www.yourdomain.com&quot; \
  -e &quot;LETSENCRYPT_EMAIL=your@youremail.com&quot; \
  ... # put the rest of the necessary settings here
</code></pre>

<p>The <code>LETSENCRYPT_HOST</code> and <code>LETSENCRYPT_EMAIL</code> are necessary, so Let&rsquo;s Encrypt service can automatically create and renew valid certificate for each virtual host.</p>

<p><strong>3. Install MySQL database</strong></p>

<p>I&rsquo;m using <a href="https://hub.docker.com/_/mysql/">MySQL official image</a>. I&rsquo;m storing the MySQL data in host directory to prevent data loss when the container restart or die.</p>

<pre><code>/home/user/:$ mkdir data

/home/user/:$ docker run --name wp_mysql \
  -v /home/user/data:/var/lib/mysql \
  -e MYSQL_ROOT_PASSWORD=my-secret-pw \
  -e MYSQL_USER=my-user \
  -e MYSQL_USER_PASSWORD=my-password \
  -e MYSQL_DATABASE=wordpress -d mysql:latest
</code></pre>

<p>For my case, I&rsquo;m importing my MySQL dump from the old WordPress setup to the MySQL container.</p>

<pre><code>/home/user/:$ docker exec -i wp_mysql mysql -umy-user -pmy-password wordpress &lt; dump.sql
</code></pre>

<p><strong>4. Containerize the Old WordPress Setup</strong></p>

<p>I&rsquo;m not using WordPress official image since this is an existing blog, not a new one. So, I re-arrange my WordPress directory structure before containerizing it. Here is the structure.</p>

<pre><code>wordpress_root
| src (for wp-content, wp-include, and the entire WordPress files)
| Dockerfile
</code></pre>

<p>This is my Dockerfile. I&rsquo;m using PHP7 Apache as a base image.</p>

<pre><code>FROM php:7-apache

MAINTAINER Asep Bagja Priandana &lt;asep@asep.co&gt;

RUN a2enmod rewrite expires

# install the PHP extensions we need
RUN apt-get update &amp;&amp; apt-get install -y libpng12-dev libjpeg-dev &amp;&amp; rm -rf /var/lib/apt/lists/* \
	&amp;&amp; docker-php-ext-configure gd --with-png-dir=/usr --with-jpeg-dir=/usr \
	&amp;&amp; docker-php-ext-install gd mysqli opcache

# set recommended PHP.ini settings
# see https://secure.php.net/manual/en/opcache.installation.php
RUN { \
		echo 'opcache.memory_consumption=128'; \
		echo 'opcache.interned_strings_buffer=8'; \
		echo 'opcache.max_accelerated_files=4000'; \
		echo 'opcache.revalidate_freq=60'; \
		echo 'opcache.fast_shutdown=1'; \
		echo 'opcache.enable_cli=1'; \
} &gt; /usr/local/etc/php/conf.d/opcache-recommended.ini

COPY src/ /var/www/html/
</code></pre>

<p>Then modify the existing <code>wp-config.php</code>.</p>

<pre><code>// Don't hardcode your DB setting. Instead use environment variable.
/** The name of the database for WordPress */
define('DB_NAME', getenv('WORDPRESS_DB_NAME'));

/** MySQL database username */
define('DB_USER', getenv('WORDPRESS_DB_USER'));

/** MySQL database password */
define('DB_PASSWORD', getenv('WORDPRESS_DB_PASSWORD'));

/** MySQL hostname */
define('DB_HOST', getenv('WORDPRESS_DB_HOST'));

// Add these 2 lines, because we are running the Apache behind Nginx proxy
// Otherwise you will get infinite redirect
if ($_SERVER['HTTP_X_FORWARDED_PROTO'] == 'https')
  $_SERVER['HTTPS']='on';

if (isset($_SERVER['HTTP_X_FORWARDED_HOST'])) {
  $_SERVER['HTTP_HOST'] = $_SERVER['HTTP_X_FORWARDED_HOST'];
}
</code></pre>

<p>Now, you can build your custom WordPress image.</p>

<pre><code>/home/user/:$ docker build -t user/my_wordpress .
</code></pre>

<p><strong>5. Run the WordPress Image</strong></p>

<p>Let&rsquo;s run the newly created image.</p>

<pre><code>/home/user/:$ docker run --name my_wordpress \
  --link wp_mysql:mysql \
  -e WORDPRESS_DB_USER=my-user \
  -e WORDPRESS_DB_PASSWORD=my-password \
  -e WORDPRESS_DB_NAME=wordpress \
  -e &quot;WORDPRESS_DB_HOST=172.17.0.3&quot; \
  -e &quot;VIRTUAL_HOST=yourdomain.com&quot; \
  -e &quot;LETSENCRYPT_HOST=yourdomain.com,www.yourdomain.com&quot; \
  -e &quot;LETSENCRYPT_EMAIL=your@youremail.com&quot; -d user/my_wordpress
</code></pre>

<p>Be careful, WORDPRESS_DB_HOST is your MySQL container&rsquo;s IP address.</p>

<p><strong>6. Pointing your domain to the host</strong></p>

<p>Now you can open your DNS manager and point the A record to your host IP and make www CNAME record with @ value. After the DNS propagation has completed and everything is correctly configured, you can access your website and see the little green lock icon on your browser.</p>

<p><strong>7. The last is configuring the URL inside your wp-admin</strong></p>

<p>Login to your WordPress dashboard then goes to Settings &gt; General. Replace the http with https.</p>

<p><img src="wordpress.png" alt="wordpress" /></p>

<p>Voila, now your WordPress site has ben secured and Google will love it.</p>

              <div class="comments" id="comments">
                <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "asepnew" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
              </div>
            </div>
          </div>
        </div>
        
      </div>
    </div>
  </div>
</section>

<script type="text/javascript" src="//downloads.mailchimp.com/js/signup-forms/popup/unique-methods/embed.js" data-dojo-config="usePlainJson: true, isDebug: false"></script><script type="text/javascript">window.dojoRequire(["mojo/signup-forms/Loader"], function(L) { L.start({"baseUrl":"mc.us3.list-manage.com","uuid":"9d7b2c9f4c0bebc73fcfe5d85","lid":"0c177e8e7d","uniqueMethods":true}) })</script>
<footer id="footer" class="inverted">
  <div class="copyright-content">
    <div class="container">
      <div class="copyright-text text-center">&copy; 2019 Asep Bagja Priandana. All Rights Reserved.</div>
    </div>
  </div>
</footer>

</div>

    <a id="scrollTop"><i class="icon-chevron-up1"></i><i class="icon-chevron-up1"></i></a>

    <script src="/js/jquery.js"></script>
    <script src="/js/plugins.js"></script>
    <script src="/js/functions.js"></script>
  </body>
</html>
