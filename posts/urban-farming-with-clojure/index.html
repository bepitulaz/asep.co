<!DOCTYPE html>
<html lang="en-gb">

  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <meta name="author" content="Asep Bagja Priandana">
    <meta name="description" content="My personal web">
    <meta name="keywords" content="blog,developer,personal">

    <meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Urban Farming with Clojure"/>
<meta name="twitter:description" content="Currently, I&rsquo;m developing an indoor farming system to grow vegetables (at the moment is Lettuce) and herbs in my house. You can check the project&rsquo;s progress on my Hackaday&rsquo;s page. The system should controls the lighting on and off at the correct time, logs the temperature and humidity and triggers the fan based on it, and sends the farm log to the server, so, I can predict the harvest time and the farm optimal condition in the future."/>


    <base href="https://asepbagja.com/posts/urban-farming-with-clojure/">
    <title>
  Urban Farming with Clojure · Asep&#39;s Notes
</title>

    <link rel="canonical" href="https://asepbagja.com/posts/urban-farming-with-clojure/">

    <link href="https://fonts.googleapis.com/css?family=Lato:400,700|Merriweather:300,700|Source+Code+Pro:400,700" rel="stylesheet">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.3.1/css/all.css" integrity="sha384-mzrmE5qonljUremFsqc01SB46JvROS7bZs3IO2EmfFsd15uHvIt+Y8vEf7N7fWAU" crossorigin="anonymous" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/normalize/8.0.0/normalize.min.css" integrity="sha256-oSrCnRYXvHG31SBifqP2PM1uje7SJUyX0nTwO2RJV54=" crossorigin="anonymous" />

    
      
      
      <link rel="stylesheet" href="https://asepbagja.com/css/coder.min.8881182b3ec36ffd9c735306f7e16ce9b1129ebc650e069e7c4114827e9d9b23.css" integrity="sha256-iIEYKz7Db/2cc1MG9&#43;Fs6bESnrxlDgaefEEUgn6dmyM=" crossorigin="anonymous" media="screen" />
    

    

    

    

    <link rel="icon" type="image/png" href="https://asepbagja.com/images/favicon-32x32.png" sizes="32x32">
    <link rel="icon" type="image/png" href="https://asepbagja.com/images/favicon-16x16.png" sizes="16x16">

    

    <meta name="generator" content="Hugo 0.55.0-DEV" />
  </head>

  <body class=" ">
    <main class="wrapper">
      <nav class="navigation">
  <section class="container">
    <a class="navigation-title" href="https://asepbagja.com/">
      Asep&#39;s Notes
    </a>
    <input type="checkbox" id="menu-toggle" />
    <label class="menu-button float-right" for="menu-toggle"><i class="fas fa-bars"></i></label>
    <ul class="navigation-list">
      
        
          <li class="navigation-item">
            <a class="navigation-link" href="https://asepbagja.com/posts/">Blog</a>
          </li>
        
      
      
    </ul>
  </section>
</nav>


      <div class="content">
        
  <section class="container post">
    <article>
      <header>
        <div class="post-title">
          <h1 class="title">Urban Farming with Clojure</h1>
        </div>
        <div class="post-meta">
          <div class="date">
            <span class="posted-on">
              <i class="fas fa-calendar"></i>
              <time datetime='2015-08-09T00:00:00Z'>
                August 9, 2015
              </time>
            </span>
            <span class="reading-time">
              <i class="fas fa-clock"></i>
              2 minutes read
            </span>
          </div>
          
          <div class="tags">
  <i class="fas fa-tag"></i>
    <a href="https://asepbagja.com/tags/clojure/">clojure</a>
      <span class="separator">•</span>
    <a href="https://asepbagja.com/tags/projects/">Projects</a>
      <span class="separator">•</span>
    <a href="https://asepbagja.com/tags/raspberry-pi/">raspberry pi</a></div>

        </div>
      </header>

      <div>
        <p>Currently, I&rsquo;m developing an indoor farming system to grow vegetables (at the moment is Lettuce) and herbs in my house. You can check the project&rsquo;s progress on <a href="https://hackaday.io/project/7124-tanibox-indoor-farming-system">my Hackaday&rsquo;s page</a>. The system should controls the lighting on and off at the correct time, logs the temperature and humidity and triggers the fan based on it, and sends the farm log to the server, so, I can predict the harvest time and the farm optimal condition in the future. At the heart of the system, I&rsquo;m using Raspberry Pi as a micro controller.</p>

<p>Physical world is actually concurrent, thus why not give Clojure a shot? It&rsquo;s a good language for handling concurrency, right?</p>

<p>So, here is my first working version of my code for controlling the LED growing lamp.</p>
<div class="highlight"><pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">(ns farmbox.lighting
  (:require [clojure.core.async :as a :refer [&gt;! &lt;! &gt;! &lt;!! go chan close!]]
            [gpio.core :as gpio]))

  (def port (gpio/open-port 4))

  (defn switch-on []
    &#34;Switch the lamp on.&#34;
    (if (= (gpio/read-value port) :high)
      (do (gpio/set-direction! port :out)
          (gpio/write-value! port :low)
          &#34;Lamp is on&#34;)
      &#34;Lamp is on&#34;))

  (defn switch-off []
    &#34;Switch the lamp off.&#34;
    (if (= (gpio/read-value port) :low)
      (do (gpio/write-value! port :high)
          (gpio/set-direction! port :in)
          (gpio/close! port)
          &#34;Lamp is off&#34;)
      &#34;Lamp is off&#34;))

  (defn lighting-machine []
    &#34;Create the process for turning on/off the lights.&#34;
    (let [in (chan)
          out (chan)]
      (go (let [input (&lt;! in)]
        (cond
          (= input &#34;on&#34;) (&gt;! out (switch-on))
          (= input &#34;off&#34;) (&gt;! out (switch-off)))
          (do (close! in)
              (close! out))))
      [in out]))

(defn plug-the-machine [switch-status]
  &#34;Call the process of lighting here.&#34;
  (let [[in out] (lighting-machine)]
    (&gt;!! in switch-status)
    (println (&lt;!! out))))</pre></div>
<p>I gave <code>Lamp is off</code> and <code>Lamp is on</code> string because go channel can&rsquo;t be given <code>nil</code> value.</p>

<p><strong>The drawback of using Clojure in Raspberry Pi</strong></p>

<p>Although Clojure is good for handling concurrency, but its runtime is too heavy for device with limited resources likes Raspberry Pi. Its startup time can takes around 2 minutes. It won&rsquo;t be a big problem for production, because you only start the app once. Otherwise it will give some pains in the ass when in development phase, the compile time and the startup time are too slow.</p>

<p>In the second iteration, I will try to evaluate NodeJS as the runtime and use ClojureScript for coding it.</p>

      </div>

      <footer>
        
      </footer>
    </article>

    
  </section>

      </div>

      <footer class="footer">
  <section class="container">
    
     © 2019
    
       · 
      Powered by <a href="https://gohugo.io/">Hugo</a> & <a href="https://github.com/luizdepra/hugo-coder/">Coder</a>.
    
    
  </section>
</footer>

    </main>

    

  </body>

</html>
